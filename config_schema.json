{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AgentConfig",
  "description": "JSON Schema describing the configuration for a Google Form / conversational agent.",
  "type": "object",
  "required": ["name", "tools", "agent_prompt", "exit_conditions"],
  "properties": {
    "name": { "type": "string", "description": "Unique agent name." },
    "version": { "type": "string", "description": "Semantic version of the agent config." },
    "agent_prompt": { "type": "string", "description": "Agent-specific system prompt to guide behavior."},
    "description": { "type": "string" },
    "tools": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name", "type", "impl"],
        "properties": {
          "name": { "type": "string", "description": "Unique tool name used in decision routing (e.g., 'sheets')." },
          "type": { "type": "string", "enum": ["input", "retrieval"], "description": "Tool category: 'input' sends data to external services; 'retrieval' fetches information to inform the user." },
          "impl": { "type": "string", "description": "Implementation identifier (e.g., 'sheets', 'web_search', 'api_retrieval', 'email')." },
          "config": { "type": "object", "description": "Tool-specific configuration object (credentials, ids, options).", "additionalProperties": true },
          
          "input_schema": {
            "description": "Optional per-tool input schema. Can be a JSON Schema object or a simplified field list describing expected inputs (e.g., sheet columns).",
            "type": ["object", "array"],
            "additionalProperties": true
          },
          "description": { "type": "string" },
          "enabled": { "type": "boolean", "default": true }
        },
        "additionalProperties": false
      },
      "description": "List of tool configurations. Each tool must specify its name, type (input|retrieval) and implementation id."
    },
    "base_system_prompt": { "type": "string", "description": "Optional override for the global/base system prompt." },
    "history_last_n_messages": { "type": "integer", "default": 5, "minimum": 1 },
    "max_turns": { "type": "integer", "default": 20, "minimum": 1 },
    "exit_condition_mode": {
      "type": "string",
      "enum": ["or", "and"],
      "default": "or",
      "description": "How to evaluate exit_conditions: 'or' (any true ends) or 'and' (all must be true)."
    },
    "exit_conditions": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["type", "expression"],
        "properties": {
          "type": { "type": "string", "enum": ["prompt", "logical", "tool_event", "max_turns"], "description": "Condition kind." },
          "expression": {
            "description": "Expression representing the condition. For 'prompt' this can be a regex or pipe-separated phrases; for 'logical' a named predicate or expression like 'is_data_complete'; for 'tool_event' an object {\"tool\": \"sheets\", \"status\": \"success\"}; for 'max_turns' an integer threshold.",
            "oneOf": [
              { "type": "string" },
              { "type": "integer" },
              { "type": "array", "items": { "type": "string" } },
              { "type": "object", "additionalProperties": true }
            ]
          },
          "description": { "type": "string" },
          "priority": { "type": "integer", "description": "Optional priority: lower numbers evaluated first." }
        },
        "additionalProperties": false
      },
      "description": "List of exit conditions; at least one is required. Conditions are evaluated according to exit_condition_mode."
    },
    "action_memory_size": { "type": "integer", "default": 5, "minimum": 0 },
    "metadata": { "type": "object", "description": "Arbitrary metadata for the agent (owner, tags, environment).", "additionalProperties": true }
  },
  
  "additionalProperties": false
}


